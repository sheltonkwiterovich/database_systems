<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Great Listens</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="main-container">
        <header>
            <nav>
                <ul>
                    <li><a href="/login1">Sign up/Log in</a></li>
                    <li><a href="/" class="title">Great Listens Audiobooks</a></li>
                    
                </ul>
            </nav>
        </header>
        <div class="sorting">
            <div class="dropdown">
                <button class="dropbtn">Sort</button>
                <div class="dropdown-content">
                    <a href="#" onclick="sortBooks('price', 'asc')">Sort by Price Low to High</a>
                    <a href="#" onclick="sortBooks('price', 'desc')">Sort by Price High to Low</a>
                    <a href="#" onclick="sortBooks('time', 'asc')">Sort by Listening Time Low to High</a>
                    <a href="#" onclick="sortBooks('time', 'desc')">Sort by Listening Time High to Low</a>
                    <!-- More sort/filter options -->
                </div>
            </div>
        </div>
       
        <main>
            <section class="book-grid" id="book-grid">
                <!-- Books will be loaded here by JavaScript -->
            </section>
        </main>
    </div>

    <script>
         // Function to fetch and display all books
         function displayBooks() {
            // URL of the API endpoint
            var url = 'http://localhost:8080/api/audiobooks';
            
            // Fetch all the books
            $.getJSON(url, function(books) {
                // Clear the existing books
                $('#book-grid').empty();
                
                // Add all books to the grid
                books.forEach(function(book) {
                    $('#book-grid').append(
                        '<div class="book-item">' +
                            '<h3>' + book.book_name + '</h3>' +
                            '<p>Author: ' + book.book_author + '</p>' +
                            '<button onclick="learnMore(' + book.book_id + ')">Learn more</button>' +
                        '</div>'
                    );
                });
            });
        }
        
        // Sort books based on the sort field and order
        function sortBooks(sortField, sortOrder) {
    var baseUrl = 'http://localhost:8080/api/audiobooks/sort/';
    var sortPath = '';

    // Check which sortField is being used and set the corresponding API path
    if (sortField === 'price') {
        sortPath = 'price/' + (sortOrder === 'asc' ? 'low-to-high' : 'high-to-low');
    } else if (sortField === 'time') {
        sortPath = 'listening-time/' + (sortOrder === 'asc' ? 'low-to-high' : 'high-to-low');
    }

    // Construct the full URL
    var url = baseUrl + sortPath;

    // Fetch the sorted books
    $.getJSON(url, function(books) {
                // Clear the existing books
                $('#book-grid').empty();
                
                // Add the sorted books to the grid
                books.forEach(function(book) {
                    $('#book-grid').append(
                        '<div class="book-item">' +
                            '<h3>' + book.book_name + '</h3>' +
                            '<p>' + book.book_author + '</p>' +
                            '<button onclick="learnMore(' + book.book_id + ')">Learn more</button>' +
                         
                        '</div>'
                    );
                });
            });
        }


        // Get all books when the page loads
        $(function() {
            sortBooks('price', 'asc'); // Default sort
        });
        
        // Function to handle "Learn more" button click
    // Function to handle "Learn more" button click
    function learnMore(bookId) {
            window.location.href = '/book/' + bookId; // Navigate to the book details page
        }
        
    </script>
</body>
</html>

